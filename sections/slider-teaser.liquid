{% schema %}
{
  "name": "Teaser Section",
  "settings": [
    {
      "type": "video",
      "id": "video_url",
      "label": "Video URL"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Comfort aisa, ki ab kya bataaiyen*"
    },
    {
      "type": "text",
      "id": "caption",
      "label": "Caption",
      "default": "Comfort soo good, youâ€™re lost for words."
    }, 
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Ludic Slides"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Built with our rugged CloudFrameâ„¢ material and a recovery EVA footbed for a cloud-like comfort and all-day support. Theyâ€™re designed to promote muscle recovery and deliver an unwinding experience. Game-changers? You bet."
    },
    {
      "type": "text",
      "id": "hidden_price",
      "label": "Hidden Price",
      "default": "1XXX"
    },
    {
      "type": "number",
      "id": "timer_days",
      "label": "Timer Duration in Days",
      "default": 1
    },
    {
      "type": "number",
      "id": "timer_hours",
      "label": "Timer Duration in Hours",
      "default": 12
    },
    {
      "type": "number",
      "id": "timer_minutes",
      "label": "Timer Duration in Minutes",
      "default": 0
    },
    {
      "type": "number",
      "id": "timer_seconds",
      "label": "Timer Duration in Seconds",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Teaser Section"
    }
  ]
}
{% endschema %}

<div class="teaser-main">
  <div class="container">
    <div class="teaser-container">
    <div class="teaser-video">
      <!-- Dynamically load video URL -->
      <video width="100%" autoplay loop muted playsinline>
        <!-- <source src="{{ section.settings.video_url | asset_url }}" type="video/mp4"> -->
        <source src="https://cdn.shopify.com/videos/c/o/v/10b4bbf018004d0a8af314f8a70f35e5.mp4" type="video/mp4">
      </video>
    </div>
  
    <div class="teaser-content">
      <!-- Dynamic Heading -->
      <h2>{{ section.settings.heading }}</h2>
      <p class="teaser-caption">{{ section.settings.caption }}</p>
  
      <!-- Countdown Timer -->
      <div class="countdown">
        <p>Get Early Access | <span id="timer">00 : 00 : 00 : 00</span></p>
      </div>
  
      <!-- Dynamic Subheading and Description -->
      <h3>Ludic Slider</h3>
      <p class="teaser-description">
        {{ section.settings.description }}
      </p>
  
      <!-- Hidden Price -->
      <div class="hidden-price">
        <!-- <span>â‚¹{{ section.settings.hidden_price }}</span> -->
        <span>â‚¹1,XXX</span>
      </div>
      
    <div id="form-section">
      <!-- Form to reveal the price -->
      <form  method="POST" id="reveal-price-form">
        <div class="input_div">
        <label for="first-name">Full Name<span>*</span></label>
          <input type="text" id="first-name" name="first_name" placeholder="Enter full name" required>
          <i class="ri-error-warning-line"></i>
        </div>
        <label for="email">Email Address<span>*</span></label>
        <div class="input_div">
          <input type="email" id="email" name="email" placeholder="Enter email address" required>
          <i class="ri-error-warning-line"></i>
        </div>
  
        <label for="mobile">Mobile Number<span>*</span></label>
        <div class="input_div">
          <input type="tel" id="mobile" name="mobile" placeholder="Enter mobile number" maxlength="10" pattern="\d{10}" required>
          <i class="ri-error-warning-line"></i>
        </div>
        <button id="reveal-price-btn">Price Reveal*</button>
        <span class="below-btn-text">* and a special bonus coupon for you ðŸ¤‘</span>
      </form>
    </div>

        <!-- Price Reveal Section (Hidden initially) -->
      <div class="Price-reveal" id="price-reveal-section" style="display:none;">
         <div class="reveal-price">
          <span>â‚¹1,499</span>
        </div>
        <div class="coupon-container">
          <!-- Coupon Button with Copy Functionality -->
          <button class="coupon-button" id="coupon-code" onclick="copyCouponCode()">SLIDE200</button>
          <i class="ri-file-copy-line" onclick="copyCouponCode()"></i>
          <span id="copy-feedback" class="copy-feedback">Copied!</span>
        </div>
        <div class="coupon-code-content">
          <p>- Use code the code to enjoy a flat â‚¹200 off on your purchase. </p>
          <p>- Pre-booking opens on Tuesday, January 07. </p>
          <p>- The code is valid only during the pre-booking period. </p>
          <p>- Weâ€™ll send you a friendly reminder when pre-booking goes live. </p>
          <p>- Weâ€™re big fans of the Fern ourselvesâ€”curious to see which one youâ€™ll fall for!</p>
          <p>The countdown to pre-booking starts nowâ€”see you there!</p>
        </div>
        <div>
            <img src="https://cdn.shopify.com/s/files/1/0823/6787/3328/files/c01728b3e56f1292a7fd6d9ee9b60fa0_e2d12979-0d14-403f-a9fb-82a9da415e41.png?v=1719043667" class="ludic-icon">
          <div class="go-back">
            <span>*</span><a href="/">Go back to the website</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>

<script>
  document.getElementById('reveal-price-btn').addEventListener('click', async function (event) {
    event.preventDefault(); 
    const firstNameInput = document.getElementById('first-name');
    const emailInput = document.getElementById('email');
    const mobileInput = document.getElementById('mobile');
    let isValid = true;
    
    var formSectionBtn = document.getElementById('reveal-price-btn');
    formSectionBtn.classList.add('disabled-btn');
    // Clear previous error states
    [firstNameInput, emailInput, mobileInput].forEach(input => {
        input.classList.remove('error');
        input.nextElementSibling.style.display = 'none';
    });

    // Validate each field
    if (firstNameInput.value.trim() === '') {
        firstNameInput.classList.add('error');
        firstNameInput.nextElementSibling.style.display = 'block';
        isValid = false;
    }

    if (!isValid) return;

    if (emailInput.value.trim() === '') {
        emailInput.classList.add('error');
        emailInput.nextElementSibling.style.display = 'block';
        isValid = false;
    } else if (!/\S+@\S+\.\S+/.test(emailInput.value)) {
        emailInput.classList.add('error');
        emailInput.nextElementSibling.style.display = 'block';
        isValid = false;
    }

    if (!isValid) return;

    if (mobileInput.value.trim() === '') {
        mobileInput.classList.add('error');
        mobileInput.nextElementSibling.style.display = 'block';
        isValid = false;
    } else if (!/^\d{10}$/.test(mobileInput.value)) {
        mobileInput.classList.add('error');
        mobileInput.nextElementSibling.style.display = 'block';
        isValid = false;
    }

    if (!isValid) return;
    const formData = {
        first_name: firstNameInput.value,
        email: emailInput.value,
        mobile: mobileInput.value,
    };
    localStorage.setItem('formData', JSON.stringify(formData));
    try {
        const response = await fetch('https://ludic-api.kretosstechnology.com/generate-coupon', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
              email: emailInput.value,
              phone_number: mobileInput.value,
              name: firstNameInput.value 
            }),
        });
        const data = await response.json();
        if (data.success) {
            formSectionBtn.classList.remove('disabled-btn');
            document.getElementById('form-section').style.display = 'none';
            document.querySelector('.hidden-price').style.display = 'none'; 
            document.getElementById('price-reveal-section').style.display = 'block';
            const couponButton = document.getElementById('coupon-code');
            couponButton.textContent = data.couponCode;
            couponButton.setAttribute('onclick', `copyCouponCode('${data.couponCode}')`);
            console.log(data.message);
        } else {
            formSectionBtn.classList.remove('disabled-btn');
            alert('Failed to generate coupon code. Please try again.');
        }
    } catch (error) {
        formSectionBtn.classList.remove('disabled-btn');
        console.error('Error generating coupon code:', error);
        alert('An error occurred while generating the coupon code. Please try again later.');
    }
  });
  document.getElementById('first-name').addEventListener('input', function () {
    if (this.value.trim() !== '') {
      this.classList.remove('error');
      this.nextElementSibling.style.display = 'none';
    }
  });
  document.getElementById('email').addEventListener('input', function () {
    if (this.value.trim() !== '') {
      this.classList.remove('error');
      this.nextElementSibling.style.display = 'none';
    }
  });
  document.getElementById('mobile').addEventListener('input', function () {
    if (this.value.trim() !== '') {
      this.classList.remove('error');
      this.nextElementSibling.style.display = 'none';
    }
  });
  function copyCouponCode() {
    const couponCode = document.getElementById('coupon-code');
    navigator.clipboard.writeText(couponCode.innerText)
      .then(() => {
        // Show the "Copied!" feedback text
        document.getElementById('copy-feedback').style.display = 'inline';
        setTimeout(() => {
          // Hide the feedback text after 2 seconds
          document.getElementById('copy-feedback').style.display = 'none';
        }, 2000);
      });
  }
  window.onload = function() {
    const formData = JSON.parse(localStorage.getItem('formData'));
    if (formData) {
      console.log('Form submitted data:', formData);
    }
  };
  // document.addEventListener("DOMContentLoaded", function() {
  //   // Set the target date and time for the countdown
  //   const targetDate = new Date("2024-12-31T23:59:59"); // Change this to your desired date and time

  //   function updateCountdown() {
  //     const now = new Date();
  //     const timeDifference = targetDate - now;

  //     if (timeDifference > 0) {
  //       const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
  //       const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  //       const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
  //       const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

  //       // Update the HTML with the countdown values
  //       document.getElementById("timer").innerHTML = `
  //         ${String(days).padStart(2, '0')} :
  //         ${String(hours).padStart(2, '0')} :
  //         ${String(minutes).padStart(2, '0')} :
  //         ${String(seconds).padStart(2, '0')}
  //       `;
  //     } else {
  //       clearInterval(countdownInterval);
  //       document.getElementById("timer").innerHTML = "00 : 00 : 00 : 00";
  //     }
  //   }

  //   // Update the countdown every second
  //   const countdownInterval = setInterval(updateCountdown, 1000);
  //   updateCountdown(); // Initial call to display the countdown immediately
  // });


  document.addEventListener("DOMContentLoaded", function() {
    // Set the target date and time for the countdown
    const targetDate = new Date("2025-01-07T00:00:00"); // Updated to Tuesday, January 7, 2025

    function updateCountdown() {
        const now = new Date();
        const timeDifference = targetDate - now;

        if (timeDifference > 0) {
            const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

            // Update the HTML with the countdown values
            document.getElementById("timer").innerHTML = `
              ${String(days).padStart(2, '0')} :
              ${String(hours).padStart(2, '0')} :
              ${String(minutes).padStart(2, '0')} :
              ${String(seconds).padStart(2, '0')}
            `;
        } else {
            clearInterval(countdownInterval);
            document.getElementById("timer").innerHTML = "00 : 00 : 00 : 00";
        }
    }

    // Update the countdown every second
    const countdownInterval = setInterval(updateCountdown, 1000);
    updateCountdown(); // Initial call to display the countdown immediately
});

</script>

<style>
  /* Add CSS for styling */
  .input_div{
    position: relative;
    max-width: 264px;
  }
  .input_div input.error{
    border-color: #E60013;
  }
  i.ri-error-warning-line {
    position: absolute;
    right: 12px;
    color: #E60013;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
    display: none;
  }
  .teaser-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    /* padding: 20px 20px 100px; */
    gap: 120px;
  }
  .teaser-content h2 {
    font-size: 32px;
    line-height: 39px;
    color: #1A1A1A;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .teaser-content span.asterisk {
    color: #E60013;
  }
  .teaser-video {
    flex: 1;
    max-width: 50%;
  }
  .teaser-content {
    flex: 1;
    max-width: 50%;
  }
  .teaser-caption {
    font-size: 12px;
    font-weight: normal;
    line-height: 20px;
    color: #1a1a1a;
    margin-bottom: 40px;
  }
  .countdown p {
    font-size: 12px;
    margin-bottom: 20px;
    line-height: 15px;
    color: #939598;
    font-weight: 600;
  }
  .teaser-content h3 {
    font-size: 24px;
    line-height: 29px;
    color: #1a1a1a;
    font-weight: 700;
    margin-bottom: 13px;
  }
  .teaser-description {
    font-size: 12px;
   margin-bottom: 40px;
    line-height: 16px;
  }
  .hidden-price span,
  .reveal-price span{
    font-size: 24px;
    line-height: 29px;
    color: #E60013;
    font-weight: 700;
  }
  .hidden-price,
  .reveal-price{ 
    margin-bottom: 40px;
  }
  button#reveal-price-btn.disabled-btn {
    opacity: 0.7;
    pointer-events: none;
}
  .teaser-content form label {
    font-size: 12px;
    margin-bottom: 8px;
    /* padding-bottom: 8px; */
    line-height: 15px;
    color: #1a1a1a;
    font-weight: 700;
    display: block;
  }
  .teaser-content form input {
    padding: 10px;
    width: 100%;
    max-width: 264px;
    margin-bottom: 32px;
    display: block;
    border: 0.5px solid #939598;
    font-size: 12px;
    font-weight: 500;
    line-height: 14px;
    box-shadow: none;
    outline: none;
    box-sizing: border-box;
    overflow: visible !important;
  }
  .teaser-content form button {
    padding: 13px 62px;
    background-color: #1A1A1A;
    color: #fff;
    border: none;
    margin-top: 8px;
    cursor: pointer;
    font-size: 12px;
    line-height: 15px;
    border-radius: 8px;
  }
  span.below-btn-text {
    display: block;
    font-size: 10px;
    line-height: 16px;
    margin-top: 8px;
    color: #1a1a1a;
  }

   .coupon-container {
    display: inline-flex;
    align-items: center;
    position: relative;
    gap: 7px;
    margin-bottom: 24px;
  }
  .coupon-button {
    background-color: #f4c0c0;
    color: #e60013;
    font-weight: 700;
    border: none;
    padding: 6px 21px;
    cursor: pointer;
    font-size: 16px;
    line-height: 20px;
    border-radius:8px;
  }
  .coupon-code-content p {
    font-size: 12px;
    line-height: 16px;
    margin-bottom: 0;
  }
  .coupon-code-content p:last-child {
    margin-top: 40px;
    margin-bottom: 57px;
  }
  .coupon-button:focus {
    outline: none;
  }
  .coupon-button:hover {
    background-color: #f0a0a0;
  }
  .copy-feedback {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    color: green;
    font-size: 14px;
    display: none;
  }
  img.ludic-icon {
    width: 22px;
    display: block;
    height: 11px;
  }
  .coupon-container .ri-file-copy-line:before{
    color:#939598;
    cursor: pointer;
  }
  .teaser-content label span {
    color: #E60013;
  }
  .teaser-video video {
    border-radius: 8px;
  }
  .go-back {
    margin-top: 60px;
  }
  .go-back a {
    font-size: 10px;
    line-height: 16px;
    color: #939598;
  }
  .go-back span {
    color: #E60013;
    font-size: 10px;
    line-height: 16px;
  }
  @media screen and (max-width:768px){
    .teaser-container {
      gap: 20px;
      flex-wrap: wrap;
      flex-direction: column;
    }
    .teaser-video, .teaser-content {
      max-width: 100%;
    }
    .teaser-content h2 {
      font-size: 24px;
      line-height: 29px;
    }
    .teaser-caption {
      margin-bottom: 32px;
    }
    .countdown p {
      font-size: 10px;
      margin-bottom: 20px;
      line-height: 12px;
    }
    .teaser-content h3 {
      font-size: 16px;
      line-height: 20px;
      margin-bottom: 8px;
    }
    .teaser-description {
      font-size: 10px;
      margin-bottom: 32px;
      line-height: 14px;
    }
    .hidden-price,
    .reveal-price{
      margin-bottom: 32px;
    }
    .hidden-price span,
    .reveal-price span{
      font-size: 16px;
      line-height: 20px;
    }
    .teaser-content form label {
      font-size: 10px;
      line-height: 12px;
    }
    .teaser-content form input {
      margin-bottom: 24px;
      font-size: 10px;
      line-height: 12px;
    }
    span.below-btn-text {
      font-size: 8px;
      margin-bottom: 45px;
    }
    .coupon-button {
      font-size: 12px;
      line-height: 15px;
    }
    .coupon-container{
      margin-bottom: 20px;
    }
    .coupon-code-content p {
      font-size: 10px;
      line-height: 14px;
      margin-bottom: 0;
    }
    .coupon-code-content p:last-child {
      margin-top: 32px;
      margin-bottom: 37px;
    }
    img.ludic-icon {
      margin-bottom: 32px;
    }
    .teaser-caption {
      font-size: 10px;
    }
  }
</style>

