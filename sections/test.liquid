{%- if section.settings.layout == 'box_width' -%}
  {%- assign container = 'container' -%}
{%- else -%}
  {%- assign container = 'container-fluid' -%}
{%- endif -%}

{%- style -%}
#shopify-section-{{ section.id }} .ds-lottie-scroll{
  height: {{ section.settings.scroll_height }}vh; /* ðŸ”¥ SCROLL SPACE */
  position: relative;
}

#shopify-section-{{ section.id }} .ds-lottie-sticky{
  position: sticky;
  top: 0;
  height: 100vh;
  overflow: hidden;
}

#shopify-section-{{ section.id }} lottie-player{
  width: 100%;
  height: 100%;
}
{%- endstyle -%}

<section class="ludic-section">
  <div class="{{ container }}">
    <div
      id="ds-lottie-scroll-{{ section.id }}"
      class="ds-lottie-scroll"
    >
      <div class="ds-lottie-sticky">
        <lottie-player
          id="dsMotoLottie-{{ section.id }}"
          src="https://cdn.shopify.com/s/files/1/0823/6787/3328/files/mobile-lottie.json?v=1766404097"
          background="transparent"
          speed="1">
        </lottie-player>
      </div>
    </div>
  </div>
</section>

<!-- Lottie Player -->
<script>
if (!window.lottiePlayerLoaded) {
  window.lottiePlayerLoaded = true;
  const s = document.createElement("script");
  s.src = "https://unpkg.com/@lottiefiles/lottie-player@1.7.1/dist/lottie-player.js";
  s.defer = true;
  document.head.appendChild(s);
}
</script>

<!-- Scroll â†’ Lottie scrub -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  const wrapper = document.getElementById(
    "ds-lottie-scroll-{{ section.id }}"
  );
  const player = document.getElementById(
    "dsMotoLottie-{{ section.id }}"
  );

  if (!wrapper || !player) return;

  player.addEventListener("ready", () => {
    const anim = player.getLottie();
    anim.loop = false;
    anim.goToAndStop(0, true);

    window.addEventListener("scroll", () => {
      const rect = wrapper.getBoundingClientRect();
      const progress =
        1 - rect.bottom / (window.innerHeight + rect.height);

      const clamped = Math.min(Math.max(progress, 0), 1);
      const frame = clamped * (anim.totalFrames - 1);

      anim.goToAndStop(frame, true);
    });
  });

});
</script>

{% schema %}
{
  "name": "DS Moto Lottie Scroll",
  "settings": [
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "default": "box_width",
      "options": [
        { "value": "full-width", "label": "Full Width" },
        { "value": "box_width", "label": "Box Width" }
      ]
    },
    {
      "type": "range",
      "id": "scroll_height",
      "label": "Scroll Height (vh)",
      "min": 100,
      "max": 500,
      "step": 50,
      "default": 300
    }
  ],
  "presets": [
    {
      "name": "DS Moto Lottie Scroll"
    }
  ]
}
{% endschema %}
